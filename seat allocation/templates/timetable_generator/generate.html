{% extends "base.html" %}
{% block title %}Generate Timetable - ESAL{% endblock %}
{% block content %}
<div class="mb-4">
    <a href="{{ url_for('timetable_generator.index') }}" class="btn btn-outline-secondary btn-sm"><i class="bi bi-arrow-left me-1"></i>Back</a>
</div>

<div class="card mb-4">
    <div class="card-header"><i class="bi bi-list-check me-2"></i>Subject count per department</div>
    <div class="card-body">
        <p class="mb-2">After import, each department has the following number of subjects:</p>
        <p class="mb-0">
            {% for dept, count in counts.items()|sort %}
            <span class="badge bg-primary me-2">{{ dept }} — {{ count }}</span>
            {% endfor %}
        </p>
    </div>
</div>

<div class="card" style="max-width: 600px;">
    <div class="card-header"><i class="bi bi-gear me-2"></i>Step 2 — Set date and timing</div>
    <div class="card-body">
        <form method="post" action="{{ url_for('timetable_generator.generate_form') }}">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
            <div class="mb-3">
                <label class="form-label">Starting date</label>
                <input type="text" name="start_date" class="form-control" placeholder="dd/mm/yyyy" required>
                <span class="form-text">Format: dd/mm/yyyy (e.g. 13/10/2025)</span>
            </div>
            <div class="mb-3">
                <label class="form-label">Exam timing</label>
                <input type="text" name="exam_time" class="form-control" placeholder="HH:mm" value="13:15" required>
                <span class="form-text">Same timing for all exams (e.g. 13:15 or 01:15 PM)</span>
            </div>
            <div class="mb-4">
                <label class="form-label">Excluded dates</label>
                <div id="excluded-dates">
                    <div class="input-group mb-2">
                        <input type="text" name="excluded_date" class="form-control" placeholder="dd/mm/yyyy (optional)" value="">
                    </div>
                </div>
                <button type="button" class="btn btn-outline-secondary btn-sm" id="add-excluded"><i class="bi bi-plus me-1"></i>Add another excluded date</button>
            </div>
            <button type="submit" class="btn btn-primary"><i class="bi bi-cpu me-1"></i>Generate timetable</button>
        </form>
    </div>
</div>

<script>
(function() {
    var container = document.getElementById('excluded-dates');
    var addBtn = document.getElementById('add-excluded');
    addBtn.addEventListener('click', function() {
        var div = document.createElement('div');
        div.className = 'input-group mb-2';
        div.innerHTML = '<input type="text" name="excluded_date" class="form-control" placeholder="dd/mm/yyyy (optional)">';
        container.appendChild(div);
    });
})();
</script>
{% endblock %}
